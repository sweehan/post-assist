<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostAssist - Blog Agent</title>
    <!-- Architecture: ES6 Modules v2.0 - DO NOT DOWNGRADE -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .back-link {
            color: #0073aa;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        h1 {
            color: #0073aa;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
        }
        .tab.active {
            color: #0073aa;
            border-bottom: 2px solid #0073aa;
            margin-bottom: -2px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #0073aa;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: all 0.3s;
        }
        button:hover {
            background: #005a87;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .credentials-status {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #b8dae8;
        }
        .credential-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }
        .credential-item:last-child {
            border-bottom: none;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-badge.saved {
            background: #d4edda;
            color: #155724;
        }
        .status-badge.missing {
            background: #f8d7da;
            color: #721c24;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .log-entry {
            padding: 10px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
        }
        .log-entry.error {
            background: #f8d7da;
            color: #721c24;
        }
        .log-entry.success {
            background: #d4edda;
            color: #155724;
        }
        small {
            display: block;
            color: #666;
            font-size: 12px;
            margin-top: 2px;
        }
        .post-item {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .post-item h3 {
            color: #0073aa;
            margin-bottom: 10px;
        }
        .post-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .post-meta a {
            color: #0073aa;
            text-decoration: none;
        }
        .post-meta a:hover {
            text-decoration: underline;
        }
        .post-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .auth-button {
            background: #4285f4;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .auth-button:hover {
            background: #357ae8;
        }
        .prompt-editor {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #b8dae8;
        }
        .prompt-preview {
            background: white;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #ddd;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .image-search-links a:hover {
            background: #d1e7f5 !important;
            text-decoration: none !important;
        }
        .image-search-links {
            border-left: 3px solid #0073aa;
            margin-top: 15px !important;
            padding: 12px !important;
        }
        .image-search-links > div {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-nav">
            <a href="../index.html" class="back-link">
                <span>‚Üê</span> Back to PostAssist
            </a>
            <div id="module-status" style="font-size: 12px; color: #666;"></div>
        </div>
        
        <h1>PostAssist - Blog Agent</h1>
        <p class="subtitle">Transform Google Sheets ideas into WordPress posts with AI</p>

        <div class="tabs">
            <button class="tab active" data-tab="dashboard">Dashboard</button>
            <button class="tab" data-tab="credentials">Credentials</button>
            <button class="tab" data-tab="ai-prompts">AI Prompts</button>
            <button class="tab" data-tab="posts">Generated Posts</button>
            <button class="tab" data-tab="logs">Activity Logs</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="credentials-status">
                <h3>System Status</h3>
                <div class="credential-item">
                    <span>Google OAuth 2.0</span>
                    <span class="status-badge missing" id="google-status">Not Connected</span>
                </div>
                <div class="credential-item">
                    <span>WordPress Connection</span>
                    <span class="status-badge missing" id="wp-status">Not Configured</span>
                </div>
                <div class="credential-item">
                    <span>AI Provider</span>
                    <span class="status-badge missing" id="ai-status">Not Configured</span>
                </div>
                <div class="credential-item">
                    <span>Token Expiry</span>
                    <span class="status-badge" id="token-expiry">--</span>
                </div>
            </div>

            <div class="button-group">
                <button id="check-posts-btn">Check for New Posts</button>
                <button id="generate-posts-btn">Generate Blog Posts</button>
                <button id="write-sheet-btn" style="background: #28a745;">Write to Blog Tab</button>
                <button id="test-connections-btn" style="background: #6c757d;">Test Connections</button>
            </div>

            <div id="status" class="status"></div>
            <div id="results"></div>
        </div>

        <!-- Credentials Tab -->
        <div id="credentials-tab" class="tab-content">
            <div class="section">
                <h2>Google Sheets OAuth 2.0</h2>
                
                <div class="form-group">
                    <label for="clientId">OAuth 2.0 Client ID:</label>
                    <input type="text" id="clientId" placeholder="1234567890-abc123.apps.googleusercontent.com">
                    <small>Get this from Google Cloud Console > APIs & Services > Credentials</small>
                </div>
                
                <div class="form-group">
                    <label for="clientSecret">Client Secret (for refresh token):</label>
                    <input type="password" id="clientSecret" placeholder="GOCSPX-...">
                    <small>Required for automatic token refresh</small>
                </div>
                
                <div class="form-group">
                    <label for="spreadsheetId">Spreadsheet ID:</label>
                    <input type="text" id="spreadsheetId" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                    <small>Find this in your sheet's URL between /d/ and /edit</small>
                </div>
                
                <button id="save-google-btn">Save Settings</button>
                <button id="auth-google-btn" class="auth-button">
                    <svg width="18" height="18" viewBox="0 0 48 48">
                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                    </svg>
                    Connect with Google
                </button>
                
                <div id="auth-status" style="margin-top: 10px;"></div>
            </div>

            <div class="section">
                <h2>WordPress Configuration</h2>
                
                <div class="form-group">
                    <label for="wpUrl">WordPress URL:</label>
                    <input type="url" id="wpUrl" placeholder="https://yoursite.com">
                </div>
                
                <div class="form-group">
                    <label for="wpUsername">Username:</label>
                    <input type="text" id="wpUsername" placeholder="your-username">
                </div>
                
                <div class="form-group">
                    <label for="wpPassword">Application Password:</label>
                    <input type="password" id="wpPassword" placeholder="xxxx xxxx xxxx xxxx">
                </div>
                
                <button id="save-wp-btn">Save WordPress Credentials</button>
            </div>

            <div class="section">
                <h2>AI Configuration</h2>
                
                <div class="form-group">
                    <label for="aiProvider">AI Provider:</label>
                    <select id="aiProvider">
                        <option value="claude">Claude API</option>
                        <option value="openai">OpenAI</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="aiKey">AI API Key:</label>
                    <input type="password" id="aiKey" placeholder="Your AI API key">
                </div>
                
                <div id="claudeProxyGroup" class="form-group">
                    <label for="proxyUrl">Cloudflare Worker URL (for Claude):</label>
                    <input type="url" id="proxyUrl" placeholder="https://your-worker.workers.dev">
                </div>
                
                <button id="save-ai-btn">Save AI Configuration</button>
            </div>
        </div>

        <!-- AI Prompts Tab -->
        <div id="ai-prompts-tab" class="tab-content">
            <div class="prompt-editor">
                <h2>Customize AI Prompts</h2>
                <p>Edit these prompts to control how the AI generates your blog posts</p>
                
                <div class="form-group">
                    <label for="systemPrompt">System Prompt (Sets AI personality):</label>
                    <textarea id="systemPrompt" rows="6"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="mainPrompt">Blog Generation Prompt:</label>
                    <textarea id="mainPrompt" rows="10"></textarea>
                    <small>Available variables: {title}, {keywords}, {topic}</small>
                </div>
                
                <div class="form-group">
                    <label for="audiencePrompt">Target Audience Context:</label>
                    <textarea id="audiencePrompt" rows="4"></textarea>
                </div>
                
                <button id="save-prompts-btn">Save Prompts</button>
                <button id="reset-prompts-btn" style="background: #6c757d;">Reset to Defaults</button>
                
                <div class="form-group">
                    <label>Prompt Preview:</label>
                    <div id="prompt-preview" class="prompt-preview">
                        Your saved prompts will appear here...
                    </div>
                </div>
            </div>
        </div>

        <!-- Generated Posts Tab -->
        <div id="posts-tab" class="tab-content">
            <div class="section">
                <h2>Generated Blog Posts</h2>
                <p>Recent posts generated from your ideas</p>
                <div id="posts-container">
                    <div class="loading">Loading posts...</div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs-tab" class="tab-content">
            <div class="section">
                <h2>Activity Logs</h2>
                <button id="clear-logs-btn" style="background: #dc3545;">Clear Logs</button>
                <div id="activity-logs" style="max-height: 500px; overflow-y: auto; margin-top: 20px;">
                    <!-- Logs will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Import ES6 Modules and Initialize App -->
    <script type="module">
        // ES6 MODULE ARCHITECTURE - DO NOT CONVERT TO INLINE JS
        // Import all required modules
        import { OAuthTokenManager } from '../modules/oauth-token-manager.js';
        import { AIAPIManager } from '../modules/ai-api-manager.js';
        import { UIComponents, injectUIStyles } from '../modules/shared-ui-components.js';
        import { CredentialsManager, PostsManager } from '../modules/storage-credentials-manager.js';
        import { AIPromptManager } from '../modules/ai-prompt-manager.js';
        
        // Display module loading status
        document.getElementById('module-status').textContent = 'Modules loaded ‚úì';
        
        /**
         * BlogPostAgent - ES6 Modular Version
         * Architecture: Modular ES6 with shared components
         * Dependencies: See imports above
         * 
         * IMPORTANT: When modifying this file:
         * - Maintain ES6 module imports
         * - Use shared components for all functionality
         * - Do not add inline event handlers
         * - Do not duplicate code that exists in modules
         */
        class BlogPostAgent {
            constructor() {
                // Initialize shared modules
                this.ui = new UIComponents({
                    logContainer: 'activity-logs',
                    statusContainer: 'status'
                });
                
                this.oauth = new OAuthTokenManager({
                    storageKey: 'blogAgent_google',
                    scope: 'https://www.googleapis.com/auth/spreadsheets',
                    onTokenRefresh: (token, expiry) => this.onTokenRefreshed(token, expiry),
                    onTokenExpiry: (error) => this.onTokenExpired(error)
                });
                
                this.ai = new AIAPIManager({
                    storageKey: 'blogAgent_ai'
                });
                
                this.credentials = new CredentialsManager({
                    namespace: 'blogAgent'
                });
                
                this.posts = new PostsManager({
                    namespace: 'blogAgent',
                    maxPosts: 100
                });
                
                this.prompts = new AIPromptManager({
                    namespace: 'blog',
                    storageKey: 'blogAgent_prompts'
                });
                
                // Sheet data
                this.sheetData = [];
                
                // Track posts being written to prevent duplicates
                this.postsBeingWritten = new Set();
                
                // Initialize UI
                this.ui.initializeTabs();
                this.setupEventListeners();
                
                // Load saved data
                this.loadAllData();
                
                // Start monitoring
                this.startMonitoring();
                
                this.ui.addLog('PostAssist Blog Agent initialized', 'success');
                this.ui.addLog('Updates applied: Results clearing fixed, Image search links added');
            }
            
            // Set up all event listeners
            setupEventListeners() {
                // Dashboard buttons
                document.getElementById('check-posts-btn').addEventListener('click', () => this.checkNewPosts());
                document.getElementById('generate-posts-btn').addEventListener('click', () => this.generatePosts());
                document.getElementById('write-sheet-btn').addEventListener('click', () => this.writeToSheet());
                document.getElementById('test-connections-btn').addEventListener('click', () => this.testConnections());
                
                // Credential buttons
                document.getElementById('save-google-btn').addEventListener('click', () => this.saveGoogleCredentials());
                document.getElementById('auth-google-btn').addEventListener('click', () => this.authenticateGoogle());
                document.getElementById('save-wp-btn').addEventListener('click', () => this.saveWordPressCredentials());
                document.getElementById('save-ai-btn').addEventListener('click', () => this.saveAICredentials());
                
                // Prompt buttons
                document.getElementById('save-prompts-btn').addEventListener('click', () => this.savePrompts());
                document.getElementById('reset-prompts-btn').addEventListener('click', () => this.resetPrompts());
                
                // Logs button
                document.getElementById('clear-logs-btn').addEventListener('click', () => this.clearLogs());
                
                // AI provider change
                document.getElementById('aiProvider').addEventListener('change', () => this.updateAIFields());
                
                // Prompt text area changes - reduced debounce time for faster response
                ['systemPrompt', 'mainPrompt', 'audiencePrompt'].forEach(id => {
                    document.getElementById(id).addEventListener('input', 
                        this.ui.debounce(() => this.updatePromptPreview(), 300)
                    );
                });
                
                // Add tab change listener to refresh posts display
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        if (tab.getAttribute('data-tab') === 'posts') {
                            this.displayPosts();
                        } else if (tab.getAttribute('data-tab') === 'dashboard') {
                            // Clear results when switching to dashboard
                            const resultsDiv = document.getElementById('results');
                            if (resultsDiv) resultsDiv.innerHTML = '';
                        }
                    });
                });
            }
            
            // Load all saved data
            loadAllData() {
                // Load OAuth data
                this.oauth.loadFromStorage();
                
                // Load credentials
                this.loadCredentialsToUI();
                
                // Update dashboard
                this.updateDashboard();
                
                // Load posts
                this.displayPosts();
                
                // Load prompts
                this.loadPromptsToUI();
            }
            
            // Load credentials to UI
            loadCredentialsToUI() {
                // Google credentials
                const googleCreds = this.credentials.loadCredentials('google');
                if (googleCreds.clientId) document.getElementById('clientId').value = googleCreds.clientId;
                if (googleCreds.clientSecret) document.getElementById('clientSecret').value = googleCreds.clientSecret;
                if (googleCreds.spreadsheetId) document.getElementById('spreadsheetId').value = googleCreds.spreadsheetId;
                
                // WordPress credentials
                const wpCreds = this.credentials.loadCredentials('wordpress');
                if (wpCreds.url) document.getElementById('wpUrl').value = wpCreds.url;
                if (wpCreds.username) document.getElementById('wpUsername').value = wpCreds.username;
                if (wpCreds.password) document.getElementById('wpPassword').value = wpCreds.password;
                
                // AI configuration
                const aiConfig = this.ai.getStatus();
                document.getElementById('aiProvider').value = aiConfig.provider;
                if (this.ai.apiKey) document.getElementById('aiKey').value = this.ai.apiKey;
                if (this.ai.proxyUrl) document.getElementById('proxyUrl').value = this.ai.proxyUrl;
                
                this.updateAIFields();
            }
            
            // Load prompts to UI
            loadPromptsToUI() {
                const prompts = this.prompts.getPrompts('blog');
                document.getElementById('systemPrompt').value = prompts.system;
                document.getElementById('mainPrompt').value = prompts.main;
                document.getElementById('audiencePrompt').value = prompts.audience;
                
                // Force update prompt preview after loading
                this.updatePromptPreview();
            }
            
            // Update prompt preview
            updatePromptPreview() {
                const preview = this.prompts.generatePreview('blog');
                const previewText = `SYSTEM:\n${preview.system}\n\nMAIN PROMPT:\n${preview.main}\n\nAUDIENCE:\n${preview.audience}`;
                document.getElementById('prompt-preview').textContent = previewText;
            }
            
            // Save Google credentials
            saveGoogleCredentials() {
                const clientId = document.getElementById('clientId').value;
                const clientSecret = document.getElementById('clientSecret').value;
                const spreadsheetId = document.getElementById('spreadsheetId').value;
                
                this.oauth.updateCredentials(clientId, clientSecret);
                this.credentials.saveCredentials('google', {
                    clientId,
                    clientSecret,
                    spreadsheetId
                });
                
                this.ui.showStatus('Google settings saved!', 'success');
                this.ui.addLog('Google settings updated');
                this.updateDashboard();
            }
            
            // Save WordPress credentials
            saveWordPressCredentials() {
                const wpCreds = {
                    url: document.getElementById('wpUrl').value,
                    username: document.getElementById('wpUsername').value,
                    password: document.getElementById('wpPassword').value
                };
                
                this.credentials.saveCredentials('wordpress', wpCreds);
                this.ui.showStatus('WordPress credentials saved!', 'success');
                this.ui.addLog('WordPress credentials updated');
                this.updateDashboard();
            }
            
            // Save AI credentials
            saveAICredentials() {
                const config = {
                    provider: document.getElementById('aiProvider').value,
                    apiKey: document.getElementById('aiKey').value,
                    proxyUrl: document.getElementById('proxyUrl').value
                };
                
                this.ai.updateConfig(config);
                this.ui.showStatus('AI configuration saved!', 'success');
                this.ui.addLog('AI configuration updated');
                this.updateDashboard();
            }
            
            // Save prompts
            savePrompts() {
                const prompts = {
                    system: document.getElementById('systemPrompt').value,
                    main: document.getElementById('mainPrompt').value,
                    audience: document.getElementById('audiencePrompt').value
                };
                
                this.prompts.setPrompts('blog', prompts);
                this.ui.showStatus('Prompts saved!', 'success');
                this.ui.addLog('AI prompts updated');
            }
            
            // Reset prompts
            resetPrompts() {
                this.prompts.resetToDefaults('blog');
                this.loadPromptsToUI();
                this.ui.showStatus('Prompts reset to defaults', 'success');
                this.ui.addLog('Prompts reset to defaults');
            }
            
            // Authenticate with Google
            authenticateGoogle() {
                try {
                    this.oauth.authenticate();
                } catch (error) {
                    this.ui.showStatus(error.message, 'error');
                }
            }
            
            // Update dashboard status
            updateDashboard() {
                // Google status
                const googleStatus = this.oauth.getStatus();
                this.ui.updateCredentialStatus(
                    'google-status', 
                    googleStatus.isAuthenticated,
                    googleStatus.canAutoRefresh ? 'Connected (Auto-refresh)' : 'Connected',
                    'Not Connected'
                );
                
                // WordPress status
                const wpValidation = this.credentials.validateCredentials('wordpress');
                this.ui.updateCredentialStatus('wp-status', wpValidation.valid);
                
                // AI status
                const aiStatus = this.ai.getStatus();
                this.ui.updateCredentialStatus('ai-status', aiStatus.isConfigured, 'AI Configured');
                
                // Token expiry
                if (googleStatus.expiryInfo) {
                    this.ui.updateTokenExpiryDisplay('token-expiry', googleStatus.expiryInfo.timeLeft);
                }
                
                // Update auth status text
                const authStatus = document.getElementById('auth-status');
                if (googleStatus.hasAccessToken && googleStatus.hasRefreshToken) {
                    authStatus.innerHTML = '<span style="color: green;">‚úì Connected with refresh token</span>';
                } else if (googleStatus.hasAccessToken) {
                    authStatus.innerHTML = '<span style="color: orange;">‚ö† Connected (no refresh token)</span>';
                } else {
                    authStatus.innerHTML = '<span style="color: #666;">Not connected</span>';
                }
            }
            
            // Token callbacks
            onTokenRefreshed(token, expiry) {
                this.ui.addLog('Token refreshed successfully');
                this.updateDashboard();
            }
            
            onTokenExpired(error) {
                this.ui.showStatus('Token expired. Please re-authenticate.', 'error');
                this.ui.addLog('Token expired: ' + error.message, 'error');
            }
            
            // Start monitoring
            startMonitoring() {
                // Check for OAuth callback
                this.oauth.handleAuthCallback().then(success => {
                    if (success) {
                        this.ui.showStatus('Successfully connected to Google!', 'success');
                        this.updateDashboard();
                    }
                });
                
                // Update dashboard periodically
                setInterval(() => this.updateDashboard(), 60000);
            }
            
            // Update AI fields visibility
            updateAIFields() {
                const provider = document.getElementById('aiProvider').value;
                this.ui.toggleFormField('claudeProxyGroup', provider === 'claude');
            }
            
            // Check for new posts
            async checkNewPosts() {
                try {
                    const googleCreds = this.credentials.loadCredentials('google');
                    if (!this.oauth.accessToken || !googleCreds.spreadsheetId) {
                        this.ui.showStatus('Please connect to Google Sheets first', 'error');
                        return;
                    }
                    
                    // Clear previous results
                    const resultsDiv = document.getElementById('results');
                    if (resultsDiv) {
                        resultsDiv.innerHTML = '';
                    }
                    
                    this.ui.showStatus('Checking for new posts...', 'info');
                    this.ui.addLog('Checking Ideas tab for new posts');
                    
                    // Read from Ideas tab
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${googleCreds.spreadsheetId}/values/Ideas!A:D`;
                    
                    const response = await this.oauth.makeAuthenticatedRequest(url);
                    const data = await response.json();
                    
                    if (response.ok && data.values) {
                        this.sheetData = [];
                        
                        // Process Ideas tab (skip header row)
                        for (let i = 1; i < data.values.length; i++) {
                            const row = data.values[i];
                            if (row[0]) {
                                const status = (row[3] || '').trim().toLowerCase();
                                const isProcessed = status === 'processed';
                                
                                // Debug log for first few rows
                                if (i <= 3) {
                                    console.log(`Row ${i}: Status="${row[3]}", Processed=${isProcessed}`);
                                }
                                
                                this.sheetData.push({
                                    title: row[0],
                                    keywords: row[1] || '',
                                    topic: row[2] || '',
                                    status: row[3] || 'pending', // Original status
                                    processed: isProcessed, // Case-insensitive check
                                    rowIndex: i + 1
                                });
                            }
                        }
                        
                        const pendingCount = this.sheetData.filter(item => !item.processed).length;
                        this.ui.showStatus(`Found ${pendingCount} posts to process!`, 'success');
                        this.ui.addLog(`Found ${pendingCount} posts from Ideas tab (Total rows: ${this.sheetData.length})`);
                        
                        // Display results
                        const resultsDiv = document.getElementById('results');
                        if (pendingCount > 0) {
                            resultsDiv.innerHTML = `
                                <div class="section" style="margin-top: 20px;">
                                    <h4>Posts to Generate:</h4>
                                    ${this.sheetData.filter(item => !item.processed)
                                        .map(item => `<div>‚Ä¢ ${item.title}</div>`).join('')}
                                </div>
                            `;
                        } else {
                            resultsDiv.innerHTML = '<div class="section" style="margin-top: 20px;">‚úÖ All posts have been processed!</div>';
                            // Clear after a delay
                            setTimeout(() => {
                                resultsDiv.innerHTML = '';
                            }, 5000);
                        }
                    } else {
                        throw new Error(data.error?.message || 'Failed to fetch sheet');
                    }
                } catch (error) {
                    this.ui.showStatus('Error: ' + error.message, 'error');
                    this.ui.addLog('Error checking posts: ' + error.message, 'error');
                }
            }
            
            // Generate posts
            async generatePosts() {
                try {
                    if (this.sheetData.length === 0) {
                        await this.checkNewPosts();
                    }
                    
                    const pending = this.sheetData.filter(item => !item.processed);
                    if (pending.length === 0) {
                        this.ui.showStatus('No pending posts to generate', 'info');
                        // Clear results when no posts to generate
                        const resultsDiv = document.getElementById('results');
                        if (resultsDiv) resultsDiv.innerHTML = '';
                        return;
                    }
                    
                    // Check if WordPress is configured
                    const wpCreds = this.credentials.loadCredentials('wordpress');
                    const hasWordPress = wpCreds.url && wpCreds.username && wpCreds.password;
                    
                    this.ui.showStatus(`Generating ${pending.length} blog posts...`, 'info');
                    const progressBar = this.ui.createProgressBar('results', pending.length);
                    
                    let generated = 0;
                    const processedRows = []; // Track which rows we processed
                    
                    try {
                        for (const post of pending) {
                            try {
                                this.ui.addLog(`Generating: ${post.title}`);
                                const blogPost = await this.generateBlogContent(post);
                                
                                // Save generated post
                                const savedPost = {
                                    ...blogPost,
                                    platform: 'blog',
                                    status: 'draft'
                                };
                                this.posts.savePost(savedPost);
                                
                                // Get the saved post ID
                                const allPosts = this.posts.getAllPosts();
                                const justSavedPost = allPosts[0]; // Most recent post
                                
                                // Optionally publish to WordPress
                                if (hasWordPress) {
                                    try {
                                        await this.publishToWordPress(justSavedPost);
                                    } catch (wpError) {
                                        // Continue even if WordPress publish fails
                                        this.ui.addLog(`WordPress publish skipped: ${wpError.message}`, 'error');
                                    }
                                }
                                
                                generated++;
                                progressBar.update(generated);
                                processedRows.push(post.rowIndex); // Track this row as processed
                                this.ui.addLog(`Generated: ${post.title}`, 'success');
                            } catch (error) {
                                this.ui.addLog(`Failed: ${post.title} - ${error.message}`, 'error');
                            }
                        }
                    } finally {
                        // Ensure progress bar is removed even if there's an error
                        if (progressBar && progressBar.remove) {
                            progressBar.remove();
                        }
                    }
                    
                    this.ui.showStatus(`Generation complete! Generated ${generated} posts.`, 'success');
                    
                    // Clear the results div to remove "Posts to Generate" message
                    const resultsDiv = document.getElementById('results');
                    if (resultsDiv) {
                        resultsDiv.innerHTML = '';
                        this.ui.addLog('Generation complete - clearing results display');
                    }
                    
                    // Force a refresh of the posts display
                    setTimeout(() => {
                        this.displayPosts();
                        // If on dashboard tab, ensure results are cleared
                        if (document.querySelector('.tab.active').getAttribute('data-tab') === 'dashboard') {
                            const results = document.getElementById('results');
                            if (results) results.innerHTML = '';
                        }
                    }, 100);
                    
                    // Update processed status in sheet
                    if (processedRows.length > 0) {
                        await this.updateProcessedStatus(processedRows);
                    }
                    
                } catch (error) {
                    this.ui.showStatus('Error: ' + error.message, 'error');
                    // Clear results on error
                    const resultsDiv = document.getElementById('results');
                    if (resultsDiv) resultsDiv.innerHTML = '';
                }
            }
            
            // Generate blog content with AI
            async generateBlogContent(post) {
                // Ensure post has required properties
                if (!post || !post.title) {
                    throw new Error('Invalid post data - missing title');
                }
                
                const prompts = this.prompts.getPrompts('blog');
                
                // Process the main prompt with variables
                const processedPrompt = this.prompts.processTemplate(prompts.main, {
                    title: post.title,
                    keywords: post.keywords,
                    topic: post.topic
                });
                
                // Add audience context
                const fullPrompt = `${processedPrompt}\n\nTarget Audience Context:\n${prompts.audience}`;
                
                // Generate content
                const response = await this.ai.generateContent(prompts.system, fullPrompt, {
                    maxTokens: 2000,
                    temperature: 0.7
                });
                
                // Parse the structured response
                const parsed = this.ai.parseStructuredResponse(response.content, 
                    ['TITLE', 'CONTENT', 'META_DESCRIPTION', 'FEATURED_IMAGE_SUGGESTION']
                );
                
                // Generate image search links
                const imageSearchLinks = this.generateImageSearchLinks(post.title, post.keywords);
                
                // Log for debugging
                this.ui.addLog(`Generated image search links for: ${post.title}`);
                console.log('Image search links:', imageSearchLinks); // Debug log
                
                return {
                    originalTitle: post.title,
                    title: parsed.TITLE || post.title,
                    content: parsed.CONTENT || response.content,
                    metaDescription: parsed.META_DESCRIPTION || '',
                    imageSuggestion: parsed.FEATURED_IMAGE_SUGGESTION || '',
                    imageSearchLinks: imageSearchLinks,
                    keywords: post.keywords,
                    topic: post.topic,
                    rowIndex: post.rowIndex,
                    generatedBy: this.ai.provider,
                    model: response.model
                };
            }
            
            // Generate image search links
            generateImageSearchLinks(title, keywords) {
                const searchTerms = [];
                
                // Primary search term from title
                if (title) {
                    searchTerms.push(title);
                }
                
                // Secondary term from keywords
                if (keywords) {
                    const keywordArray = keywords.split(',').map(k => k.trim()).filter(k => k);
                    if (keywordArray.length > 0) {
                        searchTerms.push(keywordArray[0]);
                    }
                }
                
                // Ensure we have at least one search term
                if (searchTerms.length === 0) {
                    searchTerms.push('stock photo');
                }
                
                // Create search links
                return {
                    unsplash: searchTerms.map(term => ({
                        term: term,
                        url: `https://unsplash.com/s/photos/${encodeURIComponent(term)}`
                    })),
                    pexels: `https://www.pexels.com/search/${encodeURIComponent(title || 'stock photo')}/`,
                    pixabay: `https://pixabay.com/images/search/${encodeURIComponent(title || 'stock photo')}/`
                };
            }
            
            // Publish to WordPress
            async publishToWordPress(post) {
                try {
                    const wpCreds = this.credentials.loadCredentials('wordpress');
                    if (!wpCreds.url || !wpCreds.username || !wpCreds.password) {
                        throw new Error('WordPress credentials not configured');
                    }
                    
                    // Clean up the URL (remove trailing slash)
                    const baseUrl = wpCreds.url.replace(/\/$/, '');
                    const wpUrl = `${baseUrl}/wp-json/wp/v2/posts`;
                    const auth = btoa(`${wpCreds.username}:${wpCreds.password}`);
                    
                    this.ui.addLog(`Publishing to WordPress: ${post.title}`);
                    
                    const response = await fetch(wpUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Basic ${auth}`
                        },
                        body: JSON.stringify({
                            title: post.title,
                            content: post.content,
                            status: 'draft', // Change to 'publish' if you want to publish immediately
                            excerpt: post.metaDescription,
                            // If you have categories/tags, add them here
                        })
                    });
                    
                    const responseText = await response.text();
                    
                    if (!response.ok) {
                        throw new Error(`WordPress API error (${response.status}): ${responseText}`);
                    }
                    
                    const result = JSON.parse(responseText);
                    this.ui.addLog(`‚úÖ Published to WordPress: ${result.link}`, 'success');
                    
                    // Update local post with WordPress URL
                    this.posts.updatePost(post.id, { 
                        wpUrl: result.link,
                        wpId: result.id,
                        wpStatus: result.status,
                        publishedAt: new Date().toISOString()
                    });
                    
                    return result;
                } catch (error) {
                    this.ui.addLog(`‚ùå WordPress publish failed: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            // Write to sheet - FIXED to append instead of overwrite
            async writeToSheet() {
                try {
                    const googleCreds = this.credentials.loadCredentials('google');
                    if (!this.oauth.accessToken || !googleCreds.spreadsheetId) {
                        this.ui.showStatus('Please connect to Google Sheets first', 'error');
                        return;
                    }
                    
                    const allPosts = this.posts.getAllPosts();
                    const blogPosts = allPosts.filter(p => p.platform === 'blog');
                    
                    if (blogPosts.length === 0) {
                        this.ui.showStatus('No posts to write. Generate posts first!', 'error');
                        return;
                    }
                    
                    this.ui.showStatus('Writing posts to Blog tab...', 'info');
                    
                    // First check for existing data
                    const existingDataUrl = `https://sheets.googleapis.com/v4/spreadsheets/${googleCreds.spreadsheetId}/values/Blog!A:A`;
                    const existingResponse = await this.oauth.makeAuthenticatedRequest(existingDataUrl);
                    
                    let startRow = 2; // Default to row 2 (after headers)
                    let needHeaders = true;
                    
                    if (existingResponse.ok) {
                        const existingData = await existingResponse.json();
                        if (existingData.values && existingData.values.length > 0) {
                            startRow = existingData.values.length + 1; // Append after last row
                            needHeaders = false; // Headers already exist
                        }
                    }
                    
                    // Prepare data - use Map to ensure unique posts
                    const headers = [['Topic', 'Keywords', 'Title', 'Meta Description', 'Featured Image', 'URL', 'Generated Content', 'Image Search URLs']];
                    
                    // Create a Map to store unique posts by title to prevent duplicates
                    const uniquePosts = new Map();
                    
                    // Add posts to map, using title as key to ensure uniqueness
                    blogPosts.forEach(post => {
                        const key = post.title || post.originalTitle;
                        if (!this.postsBeingWritten.has(key) && !uniquePosts.has(key)) {
                            uniquePosts.set(key, post);
                            this.postsBeingWritten.add(key);
                        }
                    });
                    
                    // Convert Map values to array for rows
                    const rows = Array.from(uniquePosts.values()).map(post => {
                        // Create a consolidated image URL string
                        let imageUrls = '';
                        if (post.imageSearchLinks) {
                            const urls = [];
                            if (post.imageSearchLinks.unsplash && Array.isArray(post.imageSearchLinks.unsplash) && post.imageSearchLinks.unsplash[0]) {
                                urls.push(post.imageSearchLinks.unsplash[0].url);
                            }
                            if (post.imageSearchLinks.pexels) {
                                urls.push(post.imageSearchLinks.pexels);
                            }
                            imageUrls = urls.join(' | ');
                        }
                        
                        return [
                            post.originalTitle || post.title,
                            post.keywords || '',
                            post.title,
                            post.metaDescription || '',
                            post.imageSuggestion || '',
                            post.wpUrl || '', // WordPress URL if published
                            post.content,
                            imageUrls // Add image search URLs to Instagram column
                        ];
                    });
                    
                    if (rows.length === 0) {
                        this.ui.showStatus('All posts have already been written to the sheet', 'info');
                        return;
                    }
                    
                    // Write headers only if needed
                    if (needHeaders) {
                        const headerUrl = `https://sheets.googleapis.com/v4/spreadsheets/${googleCreds.spreadsheetId}/values/Blog!A1:H1?valueInputOption=RAW`;
                        await this.oauth.makeAuthenticatedRequest(headerUrl, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                values: headers
                            })
                        });
                    }
                    
                    // Append data rows
                    const appendUrl = `https://sheets.googleapis.com/v4/spreadsheets/${googleCreds.spreadsheetId}/values/Blog!A${startRow}:append?valueInputOption=RAW&insertDataOption=INSERT_ROWS`;
                    
                    const response = await this.oauth.makeAuthenticatedRequest(appendUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            values: rows
                        })
                    });
                    
                    if (response.ok) {
                        this.ui.showStatus(`Successfully wrote ${rows.length} posts to Blog tab!`, 'success');
                        this.ui.addLog(`Wrote ${rows.length} posts to Blog sheet`);
                        
                        // Clear the results div
                        const resultsDiv = document.getElementById('results');
                        if (resultsDiv) {
                            resultsDiv.innerHTML = '';
                            this.ui.addLog('Sheet write complete - clearing results');
                        }
                        
                        // Clear the tracking set after successful write
                        this.postsBeingWritten.clear();
                        
                        // Clear local posts after successful write
                        this.posts.clearAllPosts();
                        this.displayPosts();
                    } else {
                        const error = await response.json();
                        // Clear tracking set on error
                        this.postsBeingWritten.clear();
                        throw new Error(error.error?.message || 'Failed to write to sheet');
                    }
                    
                } catch (error) {
                    // Clear tracking set on error
                    this.postsBeingWritten.clear();
                    this.ui.showStatus('Error: ' + error.message, 'error');
                    this.ui.addLog('Error writing to sheet: ' + error.message, 'error');
                }
            }
            
            // Update processed status
            async updateProcessedStatus(processedRows) {
                try {
                    const googleCreds = this.credentials.loadCredentials('google');
                    const updates = processedRows.map(rowIndex => ({
                        range: `Ideas!D${rowIndex}`,
                        values: [['Processed']]
                    }));
                    
                    if (updates.length === 0) return;
                    
                    const batchUrl = `https://sheets.googleapis.com/v4/spreadsheets/${googleCreds.spreadsheetId}/values:batchUpdate`;
                    
                    const response = await this.oauth.makeAuthenticatedRequest(batchUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            valueInputOption: 'RAW',
                            data: updates
                        })
                    });
                    
                    if (response.ok) {
                        this.ui.addLog(`Updated ${updates.length} posts as Processed in Ideas sheet`);
                    } else {
                        const error = await response.json();
                        this.ui.addLog('Error updating status: ' + (error.error?.message || 'Unknown error'), 'error');
                    }
                } catch (error) {
                    this.ui.addLog('Error updating status: ' + error.message, 'error');
                }
            }
            
            // Test WordPress connection
            async testWordPressConnection() {
                try {
                    const wpCreds = this.credentials.loadCredentials('wordpress');
                    if (!wpCreds.url || !wpCreds.username || !wpCreds.password) {
                        return { success: false, error: 'Credentials not configured' };
                    }
                    
                    const baseUrl = wpCreds.url.replace(/\/$/, '');
                    const auth = btoa(`${wpCreds.username}:${wpCreds.password}`);
                    
                    const response = await fetch(`${baseUrl}/wp-json/wp/v2/users/me`, {
                        headers: {
                            'Authorization': `Basic ${auth}`
                        }
                    });
                    
                    if (response.ok) {
                        const user = await response.json();
                        return { success: true, user: user.name };
                    } else {
                        return { success: false, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // Test connections
            async testConnections() {
                this.ui.showStatus('Testing connections...', 'info');
                
                // Test Google
                if (this.oauth.getStatus().isAuthenticated) {
                    this.ui.addLog('‚úÖ Google Sheets connected');
                } else {
                    this.ui.addLog('‚ùå Google Sheets not connected');
                }
                
                // Test WordPress
                const wpTest = await this.testWordPressConnection();
                if (wpTest.success) {
                    this.ui.addLog(`‚úÖ WordPress connected as: ${wpTest.user}`);
                } else {
                    this.ui.addLog(`‚ùå WordPress error: ${wpTest.error}`);
                }
                
                // Test AI
                if (this.ai.getStatus().isConfigured) {
                    const test = await this.ai.testConnection();
                    if (test.success) {
                        this.ui.addLog(`‚úÖ AI API connected (${test.provider})`);
                    } else {
                        this.ui.addLog('‚ùå AI API error: ' + test.error);
                    }
                } else {
                    this.ui.addLog('‚ùå AI not configured');
                }
                
                this.ui.showStatus('Connection tests complete', 'info');
            }
            
            // Display posts
            displayPosts() {
                const allPosts = this.posts.getAllPosts();
                const blogPosts = allPosts.filter(p => p.platform === 'blog');
                const container = document.getElementById('posts-container');
                
                if (blogPosts.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">No posts generated yet.</p>';
                    return;
                }
                
                container.innerHTML = blogPosts.map(post => `
                    <div class="post-item">
                        <h3>${post.title}</h3>
                        <div class="post-meta">
                            Generated: ${new Date(post.timestamp).toLocaleString()} | 
                            Model: ${post.model || 'Unknown'} |
                            ${post.wpUrl ? `<a href="${post.wpUrl}" target="_blank">View on WordPress</a>` : 'Not published'}
                        </div>
                        ${post.imageSearchLinks && post.imageSearchLinks.unsplash ? `
                            <div class="image-search-links" style="margin-top: 10px; padding: 10px; background: #f0f7ff; border-radius: 4px;">
                                <strong style="color: #0073aa;">üñºÔ∏è Find Images:</strong>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                                    ${post.imageSearchLinks.unsplash.map(link => 
                                        `<a href="${link.url}" target="_blank" style="display: inline-block; color: #0073aa; text-decoration: none; padding: 4px 8px; background: #e8f4f8; border-radius: 4px;">
                                            üì∑ Unsplash: ${link.term}
                                        </a>`
                                    ).join('')}
                                    <a href="${post.imageSearchLinks.pexels}" target="_blank" style="display: inline-block; color: #0073aa; text-decoration: none; padding: 4px 8px; background: #e8f4f8; border-radius: 4px;">
                                        üé® Pexels
                                    </a>
                                    <a href="${post.imageSearchLinks.pixabay}" target="_blank" style="display: inline-block; color: #0073aa; text-decoration: none; padding: 4px 8px; background: #e8f4f8; border-radius: 4px;">
                                        üåÖ Pixabay
                                    </a>
                                </div>
                            </div>
                        ` : ''}
                        <div class="post-actions">
                            <button onclick="window.blogAgent.viewPost('${post.id}')">View</button>
                            ${!post.wpUrl ? `<button onclick="window.blogAgent.publishPost('${post.id}')" style="background: #0073aa;">Publish</button>` : ''}
                            <button onclick="window.blogAgent.copyPost('${post.id}')" style="background: #6c757d;">Copy</button>
                            <button onclick="window.blogAgent.deletePost('${post.id}')" style="background: #dc3545;">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
            
            // View post
            viewPost(postId) {
                const post = this.posts.getAllPosts().find(p => p.id === postId);
                
                if (post) {
                    this.ui.showModal(post.title, `
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${post.content}
                        </div>
                        <div style="margin-top: 20px;">
                            <strong>Meta Description:</strong> ${post.metaDescription || 'N/A'}
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>Image Suggestion:</strong> ${post.imageSuggestion || 'N/A'}
                        </div>
                        ${post.imageSearchLinks && post.imageSearchLinks.unsplash ? `
                            <div style="margin-top: 10px;">
                                <strong>Find Images:</strong>
                                <div style="margin-top: 5px;">
                                    ${post.imageSearchLinks.unsplash.map(link => 
                                        `<a href="${link.url}" target="_blank" style="display: inline-block; margin-right: 10px; color: #0073aa;">
                                            Unsplash: ${link.term}
                                        </a>`
                                    ).join('')}
                                    <a href="${post.imageSearchLinks.pexels}" target="_blank" style="display: inline-block; margin-right: 10px; color: #0073aa;">
                                        Pexels
                                    </a>
                                    <a href="${post.imageSearchLinks.pixabay}" target="_blank" style="display: inline-block; color: #0073aa;">
                                        Pixabay
                                    </a>
                                </div>
                            </div>
                        ` : ''}
                        ${post.wpUrl ? `<div style="margin-top: 10px;">
                            <strong>WordPress URL:</strong> <a href="${post.wpUrl}" target="_blank">${post.wpUrl}</a>
                        </div>` : ''}
                    `, [
                        {
                            text: 'Copy Content',
                            onClick: () => this.copyPost(postId)
                        },
                        {
                            text: 'Close'
                        }
                    ]);
                }
            }
            
            // Publish single post
            async publishPost(postId) {
                const post = this.posts.getAllPosts().find(p => p.id === postId);
                
                if (post) {
                    if (post.wpUrl) {
                        this.ui.showStatus('Post already published to WordPress', 'info');
                        return;
                    }
                    
                    try {
                        this.ui.showStatus('Publishing to WordPress...', 'info');
                        await this.publishToWordPress(post);
                        this.ui.showStatus('Successfully published to WordPress!', 'success');
                        this.displayPosts(); // Refresh the display
                    } catch (error) {
                        this.ui.showStatus('Failed to publish: ' + error.message, 'error');
                    }
                }
            }
            
            // Copy post
            copyPost(postId) {
                const post = this.posts.getAllPosts().find(p => p.id === postId);
                if (post) {
                    this.ui.copyToClipboard(post.content, 'Post content copied!');
                }
            }
            
            // Delete post
            async deletePost(postId) {
                if (await this.ui.confirm('Are you sure you want to delete this post?')) {
                    if (this.posts.deletePost(postId)) {
                        this.ui.showStatus('Post deleted', 'success');
                        this.displayPosts();
                    }
                }
            }
            
            // Clear logs
            clearLogs() {
                if (confirm('Clear all logs?')) {
                    this.ui.clearLogs();
                }
            }
        }
        
        // Initialize the app and make it globally accessible
        const blogAgent = new BlogPostAgent();
        window.blogAgent = blogAgent; // Make available for onclick handlers
        
        // Log successful initialization
        console.log('PostAssist Blog Agent initialized successfully');
    </script>
</body>
</html>